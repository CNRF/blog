import{_ as l,D as e,c as t,o as p,a3 as i,m as a,H as h,w as r,a as k}from"./chunks/framework.Dohe277V.js";const d="/blog/assets/565ca9c531c531c8a66420651133e370_MD5.C0qDaiI6.png",o="/blog/assets/f094ed2ecee5dca16e52c0be207fb1e6_MD5.BpYdTHjP.png",c="/blog/assets/981b4889ab52d0adb46250d5b12f4dcc_MD5.BYt801kd.png",g="/blog/assets/0f6a9cfc77506344df301c670023eeaa_MD5.BoI1uL32.png",E="/blog/assets/239cd526c3d14647a61276cd7c76db45_MD5.B9HH6d70.png",b="/blog/assets/1da45db879e41653f54319dca704cfba_MD5.DDbyz4r9.png",y="/blog/assets/ecb178b9649807c23e0e0e2840bf7a2a_MD5.Buc0H1cj.png",u="/blog/assets/d6c0cd4e4c00c57d720711e5cb439544_MD5.DP1Rqc1z.png",m="/blog/assets/9b6b219074cca0c88dd7dab40949a1ec_MD5.DqDAlkfD.png",F="/blog/assets/a4fb05d1fbb3107701a8eb28284abc8f_MD5.HC30XyOM.png",D="/blog/assets/8cd8f8379f6fbbfbb33bb5027eceb868_MD5.D6ZJIF0x.png",A="/blog/assets/f441ad54ef0a5c4bc33751922948c6c8_MD5.Nrx9FAqm.png",q="/blog/assets/74a80fdbf6b3412b2455f414039c7b7e_MD5.DbDawGUs.png",M=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"database/mysql/07.MySQL的优化.md","filePath":"database/mysql/07.MySQL的优化.md","lastUpdated":1744524039000}'),f={name:"database/mysql/07.MySQL的优化.md"};function _(v,s,C,x,P,L){const n=e("font");return p(),t("div",null,[s[4]||(s[4]=i(`<p><a href="https://dev.mysql.com/doc/refman/8.0/en/optimization.html" target="_blank" rel="noreferrer">MySQL优化官网参考</a></p><h2 id="如何优化" tabindex="-1">如何优化 <a class="header-anchor" href="#如何优化" aria-label="Permalink to &quot;如何优化&quot;">​</a></h2><ul><li>设计数据库时：数据库表、字段的设计，存储引擎</li><li>利用好MySQL自身提供的功能，如索引等</li><li>横向扩展：MySQL集群、负载均衡、读写分离</li><li>SQL语句的优化（收效甚微）</li></ul><h2 id="字段设计" tabindex="-1">字段设计 <a class="header-anchor" href="#字段设计" aria-label="Permalink to &quot;字段设计&quot;">​</a></h2><blockquote><p>字段类型的选择，设计规范，范式，常见设计案例</p></blockquote><h3 id="存储ip地址" tabindex="-1">存储IP地址 <a class="header-anchor" href="#存储ip地址" aria-label="Permalink to &quot;存储IP地址&quot;">​</a></h3><p><strong>常规做法</strong>： varchar（15）</p><p><strong>优化选择</strong>：int unsigned，占用4个字节，节省空间，IP运算速度块</p><blockquote><p>inet_aton；</p><p>inet_ntoa;</p><p>a—address,n----number</p></blockquote><h3 id="尽量使用整数去表示字符串" tabindex="-1">尽量使用整数去表示字符串 <a class="header-anchor" href="#尽量使用整数去表示字符串" aria-label="Permalink to &quot;尽量使用整数去表示字符串&quot;">​</a></h3><p><strong>整型的优势</strong>：存储空间固定。往往是少量空间,运算速度块</p><blockquote><p>MySQL 内部的枚举（单选）类型和集合（多选）类型但是，<strong>实操的时候enum和set很少用</strong></p><p><strong>原因</strong>：维护成本高</p><p><strong>使用的替代方案</strong>：关联表</p></blockquote><h3 id="存储金额" tabindex="-1">存储金额 <a class="header-anchor" href="#存储金额" aria-label="Permalink to &quot;存储金额&quot;">​</a></h3><p><strong>金额，价格，统计数据的存储</strong>：对数据的精度要求高,</p><p><strong>优化选择</strong>：</p><ol><li><p><strong>price decimal（8，2）</strong>；定点数，有两位小数的定点数。</p></li><li><p>price int ，bigint，整数，小单位--&gt;大数额，如<strong>9.01 在数据库中存储2为901，在程序中进行相关处理</strong></p><blockquote><p>注意：定点数，支持很大的数，</p><p>转成小单位后，整数存储不了！</p></blockquote></li></ol><h3 id="定长数据类型和变长数据类型的选择" tabindex="-1">定长数据类型和变长数据类型的选择 <a class="header-anchor" href="#定长数据类型和变长数据类型的选择" aria-label="Permalink to &quot;定长数据类型和变长数据类型的选择&quot;">​</a></h3><p><strong>定点数和浮点数的选择</strong></p><p><strong>定点数</strong>：不会精度丢失。 占用空间随者数字的增加而增加</p><p><strong>浮点数</strong>：导致精度丢失 。占用固定的存储空间，无论存储多大的数据，占用的空间是固定的（类似于int）</p><p><strong>定长类型</strong>：存储空间固定：int，float,double.char,date,time,datetime,year,timestamp</p><p><strong>变长类型</strong>：存储空间可变：varchar,decimal,text</p><h3 id="字符串类型的选择" tabindex="-1">字符串类型的选择 <a class="header-anchor" href="#字符串类型的选择" aria-label="Permalink to &quot;字符串类型的选择&quot;">​</a></h3><p><strong>使用varchar</strong></p><blockquote><p>char(10) 如果你存abc，需要空间为10，3个存abc，7个存空字符，因为char是固定长度</p><p>varchar(10)如果你存abc，需要空间为4，3个存abc，1个存长度，varchar是可变长度</p><p><strong>超过10的部分，都会被截断</strong></p></blockquote><p><strong>text,类型独立存储，不占用字段总空间</strong></p><h3 id="尽可能选择小的数据类型和指定短的长度" tabindex="-1">尽可能选择小的数据类型和指定短的长度 <a class="header-anchor" href="#尽可能选择小的数据类型和指定短的长度" aria-label="Permalink to &quot;尽可能选择小的数据类型和指定短的长度&quot;">​</a></h3><h3 id="尽可能使用-not-null" tabindex="-1">尽可能使用 not null <a class="header-anchor" href="#尽可能使用-not-null" aria-label="Permalink to &quot;尽可能使用 not null&quot;">​</a></h3><p><strong>非<code>null</code>字段的处理要比<code>null</code>字段的处理高效些</strong>！且不需要判断是否为<code>null</code>。</p><p><code>null</code>在MySQL中，不好处理，<strong>存储需要额外空间，运算也需要特殊的运算符</strong>。如<code>select null = null</code>和<code>select null &lt;&gt; null</code>（<code>&lt;&gt;</code>为不等号）有着同样的结果，只能通过<code>is null</code>和<code>is not null</code>来判断字段是否为<code>null</code>。</p><blockquote><p>MySQL中每条记录都需要额外的存储空间，表示每个字段是否为<code>null</code>。因此通常使用特殊的数据进行占位，比如<code>int not null default 0</code>、<code>string not null default ‘’</code></p></blockquote><h3 id="字段注释要完整-见名知意" tabindex="-1">字段注释要完整，见名知意 <a class="header-anchor" href="#字段注释要完整-见名知意" aria-label="Permalink to &quot;字段注释要完整，见名知意&quot;">​</a></h3><h3 id="单表字段不宜过多" tabindex="-1">单表字段不宜过多 <a class="header-anchor" href="#单表字段不宜过多" aria-label="Permalink to &quot;单表字段不宜过多&quot;">​</a></h3><blockquote><p>当单表字段字段过多，可以考虑拆成多张表，将小长度的字段放在一张表，其余的放在其他表中</p></blockquote><h3 id="可以预留字段" tabindex="-1">可以预留字段 <a class="header-anchor" href="#可以预留字段" aria-label="Permalink to &quot;可以预留字段&quot;">​</a></h3><blockquote><p>优先满足业务，可以预留一些字段</p></blockquote><h2 id="关联表的设计" tabindex="-1">关联表的设计 <a class="header-anchor" href="#关联表的设计" aria-label="Permalink to &quot;关联表的设计&quot;">​</a></h2><blockquote><p>外键<code>foreign key</code>只能实现一对一或一对多的映射</p></blockquote><h3 id="一对多" tabindex="-1">一对多 <a class="header-anchor" href="#一对多" aria-label="Permalink to &quot;一对多&quot;">​</a></h3><blockquote><p>使用外键</p></blockquote><h3 id="多对多" tabindex="-1">多对多 <a class="header-anchor" href="#多对多" aria-label="Permalink to &quot;多对多&quot;">​</a></h3><blockquote><p>使用中间表存储两表之间的关联关系</p></blockquote><h3 id="一对一" tabindex="-1">一对一 <a class="header-anchor" href="#一对一" aria-label="Permalink to &quot;一对一&quot;">​</a></h3><blockquote><p>如商品的基本信息（<code>item</code>）和商品的详细信息（<code>item_intro</code>），通常使用相同的主键或者增加一个外键字段（<code>item_id</code>）</p></blockquote><h2 id="索引" tabindex="-1">索引 <a class="header-anchor" href="#索引" aria-label="Permalink to &quot;索引&quot;">​</a></h2><blockquote><p>关键字与数据的映射关系称为索引（==包含关键字和对应的记录在磁盘中的地址==）。关键字是从数据当中提取的用于标识、检索数据的特定内容。</p></blockquote><h3 id="索引检索为什么快" tabindex="-1">索引检索为什么快 <a class="header-anchor" href="#索引检索为什么快" aria-label="Permalink to &quot;索引检索为什么快&quot;">​</a></h3><ol><li><p>关键字相对于数据本身，==数据量小==</p></li><li><p>关键字是==有序==的，二分查找可快速确定位置</p><blockquote><p>图书馆为每本书都加了索引号（类别-楼层-书架）、字典为词语解释按字母顺序编写目录等都用到了索引。</p></blockquote></li></ol><h3 id="mysql中索引类型" tabindex="-1">MySQL中索引类型 <a class="header-anchor" href="#mysql中索引类型" aria-label="Permalink to &quot;MySQL中索引类型&quot;">​</a></h3><ol><li><strong>普通索引</strong>（<code>key</code>）</li><li><strong>唯一索引</strong>（<code>unique key</code>）</li><li><strong>主键索引</strong>（<code>primary key</code>）</li><li><strong>全文索引</strong>（<code>fulltext key</code>）</li></ol><h4 id="索引的关键字有不同的限制" tabindex="-1">索引的关键字有不同的限制： <a class="header-anchor" href="#索引的关键字有不同的限制" aria-label="Permalink to &quot;索引的关键字有不同的限制：&quot;">​</a></h4><ul><li>**普通索引：**对关键字没有限制</li><li>**唯一索引：**要求记录提供的关键字不能重复</li><li>**主键索引：**要求关键字唯一且不为null</li></ul><h3 id="索引管理语法" tabindex="-1">索引管理语法 <a class="header-anchor" href="#索引管理语法" aria-label="Permalink to &quot;索引管理语法&quot;">​</a></h3><h4 id="查看索引" tabindex="-1">查看索引 <a class="header-anchor" href="#查看索引" aria-label="Permalink to &quot;查看索引&quot;">​</a></h4><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">--查看建表语句</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">show </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">create</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 表名;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">show </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`user\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">--查看表中字段</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">desc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 表名;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">desc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">--查看表中所有索引</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SHOW </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`表名\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SHOW keys </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`表名\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SHOW </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`user_index\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SHOW keys </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`user_index\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><img src="`+d+'" alt=""></p><p><img src="'+o+`" alt=""></p><h4 id="创建索引" tabindex="-1">创建索引 <a class="header-anchor" href="#创建索引" aria-label="Permalink to &quot;创建索引&quot;">​</a></h4><h5 id="创建表之后建立索引" tabindex="-1">创建表之后建立索引 <a class="header-anchor" href="#创建表之后建立索引" aria-label="Permalink to &quot;创建表之后建立索引&quot;">​</a></h5><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">create</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> user_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> auto_increment </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">primary key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	first_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">varchar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	last_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	id_card </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	information </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">text</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 创建一个first_name和last_name的复合索引，并命名为name</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">alter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (first_name,last_name),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 创建一个id_card的唯一索引，默认以字段名作为索引名</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">alter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> UNIQUE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (id_card),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 鸡肋，全文索引不支持中文</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">alter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FULLTEXT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (information);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="创建表时指定索引" tabindex="-1">创建表时指定索引 <a class="header-anchor" href="#创建表时指定索引" aria-label="Permalink to &quot;创建表时指定索引&quot;">​</a></h5><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> user_index2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> auto_increment </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	first_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	last_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	id_card </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	information </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (first_name, last_name),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	FULLTEXT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (information),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	UNIQUE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (id_card)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="删除索引" tabindex="-1">删除索引 <a class="header-anchor" href="#删除索引" aria-label="Permalink to &quot;删除索引&quot;">​</a></h4><h5 id="删除普通索引、唯一索引、全文索引" tabindex="-1">删除普通索引、唯一索引、全文索引 <a class="header-anchor" href="#删除普通索引、唯一索引、全文索引" aria-label="Permalink to &quot;删除普通索引、唯一索引、全文索引&quot;">​</a></h5><p>根据索引名删除普通索引、唯一索引、全文索引：<code>alter table 表名 drop KEY 索引名</code></p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-----删除普通索引、唯一索引、全文索引</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">alter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 表名 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">drop</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 索引名</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">alter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">drop</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">alter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">drop</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id_card;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">alter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">drop</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> information;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="删除主键索引" tabindex="-1">删除主键索引 <a class="header-anchor" href="#删除主键索引" aria-label="Permalink to &quot;删除主键索引&quot;">​</a></h5><p>删除主键索引：<code>alter table 表名 drop primary key</code>（因为主键只有一个）。这里值得注意的是，如果主键自增长，那么不能直接执行此操作（自增长依赖于主键索引）：</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">---删除主键索引</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">alter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 表名 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">drop</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> primary key</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">alter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">drop</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> primary key</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="`+c+`" alt=""></p><p><strong>需要取消自增长</strong>：</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">--取消主键自增</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`表名\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> MODIFY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COLUMN 字段名 字段类型（长度） </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FIRST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`user_index\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> MODIFY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COLUMN id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FIRST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">---删除主键索引</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">alter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 表名 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">drop</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> primary key</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">alter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">drop</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> primary key</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="索引失效" tabindex="-1">索引失效 <a class="header-anchor" href="#索引失效" aria-label="Permalink to &quot;索引失效&quot;">​</a></h3>`,73)),a("ol",null,[s[2]||(s[2]=i('<li><p><strong>like 以%开头</strong>，索引无效；<strong>当like前缀没有%，后缀有%时，索引有效</strong>。</p><p><img src="'+g+'" alt=""></p></li><li><p><strong>or语句前后没有同时使用索引</strong>。当or左右查询字段只有一个是索引，该索引失效，只有当or左右查询字段均为索引时，才会生效</p><p><img src="'+E+'" alt=""></p></li><li><p><strong>组合索引，不是使用第一列索引</strong>，索引失效。</p><p><img src="'+b+'" alt=""></p></li><li><p><strong>数据类型出现隐式转化</strong>。如varchar不加单引号的话可能会自动转换为int型，使索引无效，产生全表扫描。</p><p><img src="'+y+'" alt=""></p></li>',4)),a("li",null,[a("p",null,[a("strong",null,[h(n,{color:"red"},{default:r(()=>s[0]||(s[0]=[k("在索引列上使用 IS NULL 或 IS NOT NULL操作，索引不一定失效，可能在某些情况会失效")])),_:1})])]),s[1]||(s[1]=i('<p><img src="'+u+'" alt=""></p><p>此处我将重新创建一个emp表（<strong>此处索引为InnoDB类型索引</strong>）</p><p><img src="'+m+'" alt=""></p><p><img src="'+F+`" alt=""></p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">----创建新索引</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">create</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> index</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> emp(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="`+D+'" alt=""></p><p><img src="'+A+'" alt=""></p>',7))]),s[3]||(s[3]=i(`<li><p><strong>在索引字段上使用not，&lt;&gt;，!=</strong>。不等于操作符是永远不会用到索引的，因此对它的处理只会产生全表扫描。 优化方法： key&lt;&gt;0 改为 key&gt;0 or key&lt;0。</p></li><li><p><strong>当全表扫描速度比索引速度快时，mysql会使用全表扫描，此时索引失效。</strong></p></li><li><p><strong>不要在字段中做运算</strong></p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">----下面两条SQL语句在语义上相同，(id为主键)但是第一条会使用主键索引而第二条不会。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li>`,3))]),s[5]||(s[5]=i(`<h2 id="索引使用场景-重点" tabindex="-1">索引使用场景（重点） <a class="header-anchor" href="#索引使用场景-重点" aria-label="Permalink to &quot;索引使用场景（重点）&quot;">​</a></h2><h3 id="where" tabindex="-1">where <a class="header-anchor" href="#where" aria-label="Permalink to &quot;where&quot;">​</a></h3><p>根据<code>id</code>查询记录，因为<code>id</code>字段仅建立了主键索引，因此此SQL执行可选的索引只有主键索引，如果有多个，最终会选一个较优的作为检索的依据。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 增加一个没有建立索引的字段</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">alter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> innodb1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 按sex检索时可选的索引为null</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EXPLAIN </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> innodb1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sex</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;男&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="`+q+'" alt=""></p><blockquote><p>可以尝试在一个字段未建立索引时，根据该字段查询的效率，然后对该字段建立索引（<code>alter table 表名 add index(字段名)</code>），同样的SQL执行的效率，你会发现查询效率会有明显的提升（数据量越大越明显）。</p></blockquote><h3 id="order-by" tabindex="-1">order by <a class="header-anchor" href="#order-by" aria-label="Permalink to &quot;order by&quot;">​</a></h3><ul><li><p><strong>该字段没有建立索引</strong></p><p>将<strong>查询出的所有数据使用外部排序</strong>（将数据从硬盘分批读取到内存使用内部排序，最后合并排序结果）</p></li><li><p><strong>该字段建立索引</strong></p><p>直接<strong>按照索引的顺序和映射关系逐条取出数据</strong>。而且如果分页的，那么只用<strong>取出索引表某个范围内的索引对应的数据</strong></p></li></ul><h3 id="join" tabindex="-1">join <a class="header-anchor" href="#join" aria-label="Permalink to &quot;join&quot;">​</a></h3><blockquote><p>对<code>join</code>语句匹配关系（<code>on</code>）涉及的字段建立索引能够提高效率</p></blockquote><h3 id="索引覆盖" tabindex="-1">索引覆盖 <a class="header-anchor" href="#索引覆盖" aria-label="Permalink to &quot;索引覆盖&quot;">​</a></h3><p>如果要查询的字段都建立过索引，那么引擎会直接在索引表中查询而不会访问原始数据（否则只要有一个字段没有建立索引就会做全表扫描），这叫索引覆盖。因此我们需要尽可能的在<code>select</code>后==只写必要的查询字段==，以增加索引覆盖的几率。</p>',12))])}const S=l(f,[["render",_]]);export{M as __pageData,S as default};
