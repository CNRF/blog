---
title: '0018.归并排序小和问题'
tags: [ '' ]
categories: [ '' ]
---

## 题目介绍

在一个数组中，一个数左边比它小的数的总和，叫数的小和，所有数的小和累加起来，叫数组小和。求数组小和。
例子： [1,3,4,2,5]

- 1左边比1小的数：没有
- 3左边比3小的数：1
- 4左边比4小的数：1、3
- 2左边比2小的数：1
- 5左边比5小的数：1、3、4、 2
  所以数组的小和为1+1+3+1+1+3+4+2=16

## 实现思路

归并排序小和问题可以通过归并排序的过程中计算小和。具体思路如下：

1. 在归并排序的合并过程中，当左侧数组的元素小于右
2. 侧数组的元素时，左侧数组的元素可以与右侧数组的所有元素形成小和。
3. 具体实现时，在合并两个有序子数组时，使用两个指针分别指向左侧和右侧数组的当前元素。
4. 当左侧元素小于右侧元素时，将左侧元素与右侧数组中剩余的所有元素相加，并累加到小和中。
5. 最后返回小和的总值。

## 代码实现

```java
package lesson.sort;

/**
 * 数组小数和问题
 * 例子： [1,3,4,2,5]
 * <p>
 * - 1左边比1小的数：没有
 * - 3左边比3小的数：1
 * - 4左边比4小的数：1、3
 * - 2左边比2小的数：1
 * - 5左边比5小的数：1、3、4、 2
 * 所以数组的小和为1+1+3+1+1+3+4+2=16
 *
 * @author mark
 *
 */


public class SmallSum {
    public int smallSum(int[] arr) {
        if (null == arr || arr.length < 2) {
            return 0;
        }
        return process(arr, 0, arr.length - 1);
    }

    private int process(int[] arr, int left, int right) {
        if (left == right) {
            return 0;
        }
        int mid = left + ((right - left) >> 1);
        return process(arr, left, mid)
                + process(arr, mid + 1, right)
                + merge(arr, left, mid, right);
    }

    private int merge(int[] arr, int left, int mid, int right) {
        int res = 0;
        int[] help = new int[right - left + 1];
        int p1 = left;
        int p2 = mid + 1;
        int i = 0;
        while (p1 <= mid && p2 <= right) {
            res = res + (arr[p1] < arr[p2] ? arr[p1] * (right - p2 + 1) : 0);
            //相等的时候优先拷贝右侧数组，
            //如[3,6,9]  [3,5,9]，如果先左边移动到6之后，
            // 右边再移动到5此时回缺少5的3的小树和
            help[i++] = arr[p1] < arr[p2] ? arr[p1++] : arr[p2++];
        }
        while (p1 <= mid) {
            help[i++] = arr[p1++];
        }
        while (p2 <= right) {
            help[i++] = arr[p2++];
        }
        for (i = 0; i < help.length; i++) {
            arr[left + i] = help[i];
        }
        return res;
    }

    public static void main(String[] args) {
        SmallSum smallSum = new SmallSum();
        int[] arr = {1, 3, 4, 2, 5};
        int i = smallSum.smallSum(arr);
        System.out.println(i);
    }

}

```